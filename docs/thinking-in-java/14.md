---
title: 第十四章-类型信息/反射
date: 2020-12-16
---

**RTTI**（Run-Time Type Identification）运行时类型识别；运行时类型识别是必要的：继承和多态提供了一种编写通用代码的能力，但是经常也会出现一些特殊情况，需要对某些类型特判；

这个词一直是 C++ 中的概念，至于Java中出现RTTI的说法则是源于《Thinking in Java》一书，其作用是在运行时识别一个对象的类型和类的信息。这里分两种：

- 编译期的：也叫传统的”RRTI”，它假定我们在编译期已知道了所有类型(在没有反射机制创建和使用类对象时，一般都是编译期已确定其类型，如new对象时该类必须已定义好)，
- 另外一种是运行期的：利用反射机制它允许我们在运行时发现和使用类型的信息。

在Java中用来表示运行时类型信息的对应类就是Class类，Class类也是一个实实在在的类，存在于JDK的java.lang包中。

实际上在Java中每个类都有一个Class对象，每当我们编写并且编译一个新创建的类就会产生一个对应Class对象并且这个Class对象会被保存在同名.class文件里；

当我们new一个新对象或者引用静态成员变量时，Java虚拟机(JVM)中的类加载器子系统会将对应Class对象加载到JVM中，然后JVM再根据这个类型信息相关的Class对象创建我们需要实例对象或者提供静态变量的引用值。注意，我们定义的一个类，无论创建多少个实例对象，在JVM中都只有一个Class对象与其对应，即：在内存中每个类有且只有一个相对应的Class对象；

到这我们也就可以得出以下几点信息：

- Class类也是类的一种，其创建后的对象称作class对象；
- 手动编写的类被编译后会产生一个Class对象，其表示的是创建的类的类型信息，而且这个Class对象保存在同名.class的文件中(字节码文件)，比如创建一个Shapes类，编译Shapes类后就会创建其包含Shapes类相关类型信息的Class对象，并保存在Shapes.class字节码文件中；
- 每个通过关键字class标识的类，无论创建多少个实例对象，在内存中有且只有一个与之对应的Class对象来描述其类型信息；
- Class类只有私有构造函数，因此对应Class对象只能有JVM创建和加载；
- Class类的对象作用是运行时提供或获得某个对象的类型信息，这点对于反射技术很重要；

注：Class对象是后面反射的基础，反射包中的很多类都需要和Class对象一起配合使用。



## 反射的概念

Reflection（反射）是被视为动态语言的关键，反射机制允许程序在执行期借助于Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法。

加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，透过这个镜子看到类的结构，所以，我们形象的称之为：反射。

![image-20201217110418307](https://raw.githubusercontent.com/MilesGO517/images/master/20201217110419.png)

### 动态语言和静态语言

**动态语言**

是一类在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以 被引进，已有的函数可以被删除或是其他结构上的变化。通俗点说就是在运 行时代码可以根据某些条件改变自身结构。

流行的动态语言：Object-C、C#、JavaScript、PHP、Python、Erlang。

**静态语言**

与动态语言相对应的，运行时结构不可变的语言就是静态语言。如Java、C、 C++。



Java不是动态语言，但Java可以称之为“准动态语言”。即Java有一定的动 态性，我们可以利用反射机制、字节码操作获得类似动态语言的特性。 Java的动态性让编程的时候更加灵活！

### Java反射机制提供的功能

- 在运行时判断任意一个对象所属的类 
- 在运行时构造任意一个类的对象 
- 在运行时判断任意一个类所具有的成员变量和方法 
- 在运行时获取泛型信息 
- 在运行时调用任意一个对象的成员变量和方法 
- 在运行时处理注解 
- 生成动态代理

### 反射相关的主要API

- java.lang.Class:代表一个类 
- java.lang.reflect.Method:代表类的方法 
- java.lang.reflect.Field:代表类的成员变量 
- java.lang.reflect.Constructor:代表类的构造器



## Class类

在Object类中定义了以下的方法，此方法将被所有子类继承，返回值的类型是一个Class类

 ● public final Class getClass()



